package com.example.newapp;

import java.util.Random;

import android.app.Activity;
import android.content.Intent;
import android.os.Bundle;
import android.util.Log;
import android.view.View;
import android.view.View.OnClickListener;
import android.view.animation.Animation;
import android.view.animation.Animation.AnimationListener;
import android.view.animation.AnimationUtils;
import android.widget.ImageView;
import android.widget.RelativeLayout;
import android.widget.TextView;
import android.widget.RelativeLayout.LayoutParams;

public class GameSpace extends Activity {
	 
	 	RelativeLayout shapeLayout, flipLayout, sizeLayout, countLayout;
		ImageView[] imageArr;
		int size = 100;
		int right_ind;
		int right_id;
		TextView count;
		
	@Override 
	    public void onCreate(Bundle savedInstanceState) {
	        super.onCreate(savedInstanceState);
	        setContentView(R.layout.game_space);
	        layouts();
	        gameShapeStart();
	 }
	
	public void swapLay(final RelativeLayout x, final RelativeLayout y)
	{
		Animation anim = AnimationUtils.loadAnimation(this, R.anim.slide_left_out);
		Animation anim1 = AnimationUtils.loadAnimation(this, R.anim.slide_left_in);
		anim.setAnimationListener(new AnimationListener(){

			public void onAnimationEnd(Animation animation) {
				x.setBackgroundResource(0);
				x.removeAllViews();
				
			}

			public void onAnimationRepeat(Animation animation) {
				// TODO Auto-generated method stub
				
			}

			public void onAnimationStart(Animation animation) {
				// TODO Auto-generated method stub
			}
			
		});
		x.startAnimation(anim);
		y.startAnimation(anim1);
		
	}
	
	public void layouts()
	{
		shapeLayout = (RelativeLayout) findViewById(R.id.shapeLay);
		flipLayout = (RelativeLayout) findViewById(R.id.flipLay);
		sizeLayout = (RelativeLayout) findViewById(R.id.sizeLay);
		countLayout = (RelativeLayout) findViewById(R.id.countLay);
		shapeLayout.bringToFront();
	}
	
	//Games starting
	
	public void gameCountStart()
	{
		countLayout.setBackgroundResource(R.drawable.bg_games2);
		Random r = new Random();
        obj_count = 3+r.nextInt(4);
        count = new TextView(this);
        count.setText("0");
        countLayout.addView(count);        
        RelativeLayout.LayoutParams objParam[] = new RelativeLayout.LayoutParams[obj_count];
        imageArr = new ImageView[obj_count];
        
        int collect[] = new int[20];
        collect[0] = R.drawable.o_album_en;
        for(int i =1; i<20; i++)
        	collect[i] = collect[i-1] +1;
        
        int instx=5, insty=100;
        for (int i=0; i<obj_count; i++)
        {	
        	objParam[i] = new RelativeLayout.LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT);
        	objParam[i].width = size;
            objParam[i].height = size;
            objParam[i].leftMargin = instx;
        	objParam[i].topMargin = insty;
        	imageArr[i] = new ImageView(this);
        	r = new Random();
        	int q = r.nextInt(20);
        	while (collect[q]==0)
        		q = r.nextInt(20);
        	imageArr[i].setBackgroundResource(collect[q]);
        	collect[q] = 0;
        	imageArr[i].setId(i+1);
        	countLayout.addView(imageArr[i],objParam[i]);
        	imageArr[i].setOnClickListener(countListener);
        	instx += objParam[i].width+5;
        }
	}
	
	public void gameShapeStart()
	 {
		shapeLayout.setBackgroundResource(R.drawable.bg_games1);
	        RelativeLayout.LayoutParams objParam[] = new RelativeLayout.LayoutParams[6];
	        imageArr = new ImageView[6];
	        
	        int collect[] = new int[6];
	        collect[0] = R.drawable.p_games_shapecircle;
	        for(int i =1; i<6; i++)
	        	collect[i] = collect[i-1] +1;
	        Random r = new Random();
	        right_ind = r.nextInt(6);
	        TextView text = new TextView(this);
	        //text.setLeft(400);
	        //text.setTop(20);
	        shapeLayout.addView(text);
	        int instx=200, insty=100;
	        for (int i=0; i<6; i++)
	        {	
	        	if (i == 3)
	        	{
	        		insty+=size+5;
	        		instx = 200;
	        	}
	        	objParam[i] = new RelativeLayout.LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT);
	        	objParam[i].width = size;
	            objParam[i].height = size;
	            objParam[i].leftMargin = instx;
	        	objParam[i].topMargin = insty;
	        	imageArr[i] = new ImageView(this);
	        	r = new Random();
	        	int q = r.nextInt(6);
	        	while (collect[q]==0)
	        		q = r.nextInt(6);
	        	imageArr[i].setId(i+1);
	        	imageArr[i].setBackgroundResource(collect[q]);
	        	if (q == right_ind)
	        		right_id = imageArr[i].getId();
	        	collect[q] = 0;
	        	shapeLayout.addView(imageArr[i],objParam[i]);
	        	imageArr[i].setOnClickListener(shapeListener);
	        	instx += objParam[i].width+5;
	        }
	        switch (right_ind)
	        {
	        	case 0:
	        		text.setText("Circle");
	        		break;
	        	case 1:
	        		text.setText("Diamond");
	        		break;
	        	case 2:
	        		text.setText("Heart");
	        		break;
	        	case 3:
	        		text.setText("Square");
	        		break;
	        	case 4:
	        		text.setText("Star");
	        		break;
	        	case 5:
	        		text.setText("Triangle");
	        		break;
	        }
	        //text.setText(text.getText() + String.valueOf(right_ind) + String.valueOf(right_id));
	        instx = 0; 
	 }
	
	public void gameSizeStart()
	{
		int[][] instArr = new int[3][2];
		int collect[] = new int[20];
        collect[0] = R.drawable.o_album_en;
        for(int i =1; i<20; i++)
        	collect[i] = collect[i-1] +1;
        
        int half = (int) size/2;
        ImageView localBox = new ImageView(this);
        RelativeLayout myLayout = (RelativeLayout) findViewById(R.id.Rlay2); 
        
        RelativeLayout.LayoutParams objParam[] = new RelativeLayout.LayoutParams[3];
        imageArr = new ImageView[3];
        RelativeLayout.LayoutParams boxParam[] = new RelativeLayout.LayoutParams[3];
        ImageView[] boxArr = new ImageView[3];
        
        
        int instx=5, insty=100;
        for (int i=0; i<3; i++)
        {	
        	//instArr[i][0] = instx;
        	//instArr[i][1] = insty;
        	objParam[i] = new RelativeLayout.LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT);
            objParam[i].leftMargin = instx;
        	objParam[i].topMargin = insty;
        	
        	imageArr[i] = new ImageView(this);
        	Random r = new Random();
        	int q = r.nextInt(20);
        	while (collect[q]==0)
        		q = r.nextInt(20);
        	imageArr[i].setBackgroundResource(collect[q]);
        	collect[q] = 0;
        	imageArr[i].setId(i+1);
        	myLayout.addView(imageArr[i],objParam[i]);
        	imageArr[i].setOnTouchListener();
        	
        	boxParam[i] = new RelativeLayout.LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT);
        	boxArr[i] = new ImageView(this);
        	boxArr[i].setId((i+1)*10);
        	//boxArr[i].setBackgroundColor(Color.BLACK);
        	myLayout.addView(boxArr[i],boxParam[i]);
        	
        	instx += objParam[i].width+5;
        	//insty += 51;
        }
        ImageView mainBox = (ImageView) findViewById(R.id.mainbox); 
        LayoutParams mainBoxParam = (LayoutParams) mainBox.getLayoutParams();
        objParam[0].width = 80;
        objParam[0].height = 80;
        objParam[1].width = 105;
        objParam[1].height = 105;
        objParam[2].width = 120;
        objParam[2].height = 120;
        objParam[0].leftMargin = 100;
        objParam[0].topMargin = 100;
        objParam[1].leftMargin = 205;
        objParam[1].topMargin = 100;
        objParam[2].leftMargin = 100;
        objParam[2].topMargin = 205;
        
        boxParam[0].width =  92;
        boxParam[0].height = 92;
        boxParam[1].width = 110;
        boxParam[1].height = 110;
        boxParam[2].width = 130;
        boxParam[2].height = 130;
        boxParam[0].leftMargin = mainBoxParam.leftMargin + 40 -10;
        boxParam[0].topMargin = mainBoxParam.topMargin + 82  -10;
        boxParam[1].leftMargin = mainBoxParam.leftMargin + 163  -10;
        boxParam[1].topMargin = mainBoxParam.topMargin + 58  -10;
        boxParam[2].leftMargin = mainBoxParam.leftMargin + 313  -10;
        boxParam[2].topMargin = mainBoxParam.topMargin + 33  -10;
        
        for (int i=0; i<3; i++)
        {	
        	instArr[i][0] = objParam[i].leftMargin;
        	instArr[i][1] = objParam[i].topMargin;
        }
	}
	
	//LISTENERS:
	
	OnClickListener shapeListener = new OnClickListener() {
	       public void onClick(View v) 
	       {
	    	   Log.v("Touch", String.valueOf(v.getId()));
	    	   	if (v.getId() == right_id)
	   			{
	   				Animation anim = AnimationUtils.loadAnimation(GameSpace.this, R.anim.shapewin);
	   				v.startAnimation(anim);
	   				swapLay(shapeLayout, countLayout);
	   				gameCountStart();
	   			}
	   			else
	   			{
	   				Animation anim = AnimationUtils.loadAnimation(GameSpace.this, R.anim.slide_right_in);
	   				anim.setRepeatCount(3);
	   				anim.setRepeatMode(Animation.REVERSE);
	   				v.startAnimation(anim);
	   			}
	      }
	 };
	 
	 OnClickListener countListener = new OnClickListener(){

		public void onClick(View v) 
		{			
			v.setVisibility(View.GONE);
			int x = Integer.parseInt((String) count.getText());
			x++;
			count.setText(String.valueOf(x));
			if (x == obj_count)
			  {
			      swapLay(countLayout, sizeLayout);
			  }
		}
		 
	 };
	 
}
